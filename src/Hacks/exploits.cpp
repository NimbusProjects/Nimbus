#include "exploits.h"

#include "../settings.h"
#include "../interfaces.h"
#include "../Hooks/hooks.h"

bool Settings::Airstuck::enabled = false;
bool Settings::TickManip::enabled = false;
bool Settings::TickOnKey::enabled = false;
bool Settings::TickOnShoot::enabled = false;
bool Settings::TickOnChoke::enabled = false;
ButtonCode_t Settings::Airstuck::key = ButtonCode_t::KEY_F;
ButtonCode_t Settings::TickOnKey::key = ButtonCode_t::KEY_G;

void Airstuck::CreateMove(CUserCmd* cmd, bool bSend)
{

  if(!Settings::TickManip::enabled)
    return;

	C_BasePlayer* localplayer = (C_BasePlayer*) entityList->GetClientEntity(engine->GetLocalPlayer());
  C_BaseCombatWeapon* activeWeapon = (C_BaseCombatWeapon*) entityList->GetClientEntityFromHandle(localplayer->GetActiveWeapon());

  if(!engine->IsInGame() || !localplayer->GetAlive())
    return;


  if (activeWeapon->GetCSWpnData()->GetWeaponType() == CSWeaponType::WEAPONTYPE_GRENADE)
    return;

	if (Settings::Airstuck::enabled && inputSystem->IsButtonDown(Settings::Airstuck::key) && !CreateMove::sendPacket2)
		cmd->tick_count += 16777216;


  if (Settings::TickOnKey::enabled && inputSystem->IsButtonDown(Settings::TickOnKey::key) && !CreateMove::sendPacket2)
      //Shift some ticks here.

  if(Settings::TickOnShoot::enabled && cmd->buttons & IN_ATTACK)
  {
    static int since_use = 0;
    static int delay_shot = 0;
    static int shoot_state = 2;
    static int state_delay = 0;

    if (delay_shot != 0 && shoot_state == 0)
    {
      delay_shot--;
      cmd->buttons &= ~IN_ATTACK;
      since_use = 0;
      if (delay_shot == 0)
      {
        shoot_state = 2;
      }
    }
    if (cmd->buttons & IN_ATTACK /*&& Settings::exploits::shift != 0 && Settings::exploits::shotdelay != 0 && Settings::exploits::statedelay != 0*/)
    {
      if (since_use++ < 3) {
        //first have to define what tickBaseShift is...will do soon! //tickBaseShift = ;
        delay_shot = 2;
        shoot_state = 1;
        state_delay = 2;
      }
    }
    if (shoot_state == 1)
    {
      state_delay--;
      if (shoot_state == 1)
        cmd->buttons |= IN_ATTACK;
      if (state_delay == 0){
        shoot_state = 0;
      }

    }
    if (state_delay <= 0)
      state_delay = 0;
    if (delay_shot <= 0)
      delay_shot = 0;
  }

  /*
  if(Settings::TickOnChoke::enabled && !CreateMove::sendPacket2 && !(cmd->buttons & IN_JUMP) &&  !(localplayer->GetFlags() & FL_ONGROUND))
      //shift some more ticks when shifting for memes
  */

}

